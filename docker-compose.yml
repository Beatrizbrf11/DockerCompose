version: "3"

services:
    visualizador:
        image: dockersamples/visualizer
        volumes:
            - "/var/run/docker.sock:/var/run/docker.sock"
        ports:
            - 8090:8090
        deploy:
            placement:
                constraints:
                    - node.role == manager
                    
    receitadespesaservice:
        image: beatrizbrffiap/imagem_receitadespesaservice
        ports:
            - 8080:8080
        restart: always
        depends_on: 
          - db # This service depends on mysql. Start that first.
        environment: # Pass environment variables to the service
          SPRING_DATASOURCE_URL: jdbc:mysql://db:3306/DBreceitaDespesa?useTimezone=true&serverTimezone=UTC
          SPRING_DATASOURCE_USERNAME: root
          SPRING_DATASOURCE_PASSWORD: R@@t2020     
        networks: # Networks to join (Services on the same network can communicate with each other using their name)
          - beatrzbrf11
   
    db:
        image: beatrizbrffiap/mysql-image
        ports:
            - "3306:3306"
        deploy:
            replicas: 3
            restart_policy:
                condition: on-failure
                max_attempts: 3
        networks:
            - beatrzbrf11
            
networks: 
    beatrzbrf11:
        external: true
